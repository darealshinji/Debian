# HG changeset patch
# User Andrew Victor <andrew.victor@mxit.com>
# Date 1464972610 18000
# Branch release-2.x.y
# Node ID f0287378203fbf496a9890bf273d96adefb93b74
# Parent  5e5e84e8a79890e580158ac2eae073d7394e93b7
Fix TALOS-CAN-0139

Index: pidgin-2.10.12/libpurple/protocols/mxit/protocol.c
===================================================================
--- pidgin-2.10.12.orig/libpurple/protocols/mxit/protocol.c	2016-07-12 08:15:38.183631970 -0400
+++ pidgin-2.10.12/libpurple/protocols/mxit/protocol.c	2016-07-12 08:15:38.179631924 -0400
@@ -1854,6 +1854,12 @@
 	/* set the count for attributes */
 	count = atoi( records[0]->fields[1]->data );
 
+	/* ensure the packet has the correct number of fields */
+	if ( records[0]->fcount < ( 2 + ( count * 3 ) ) ) {
+		purple_debug_error( MXIT_PLUGIN_ID, "Insufficient number of fields in extprofile response. fields=%i records=%i", records[0]->fcount, count );
+		return;
+	}
+
 	for ( i = 0; i < count; i++ ) {
 		char* fname;
 		char* fvalue;
