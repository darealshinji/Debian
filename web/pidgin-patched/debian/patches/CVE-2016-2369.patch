# HG changeset patch
# User Andrew Victor <andrew.victor@mxit.com>
# Date 1464902518 18000
# Branch release-2.x.y
# Node ID 7b52ca213832882c9f69b836560ba44c6e929a34
# Parent  5e5e84e8a79890e580158ac2eae073d7394e93b7
Fix for TALOS-CAN-0137

Index: pidgin-2.10.12/libpurple/protocols/mxit/protocol.c
===================================================================
--- pidgin-2.10.12.orig/libpurple/protocols/mxit/protocol.c	2016-07-12 08:15:30.659544546 -0400
+++ pidgin-2.10.12/libpurple/protocols/mxit/protocol.c	2016-07-12 08:15:30.659544546 -0400
@@ -2701,7 +2701,8 @@
 						/* new record */
 						if ( packet.rcount == 1 ) {
 							/* packet command */
-							packet.cmd = atoi( packet.records[0]->fields[0]->data );
+							if ( packet.records[0]->fcount > 0 )
+								packet.cmd = atoi( packet.records[0]->fields[0]->data );
 						}
 						else if ( packet.rcount == 2 ) {
 							/* special case: binary multimedia packets should not be parsed here */
