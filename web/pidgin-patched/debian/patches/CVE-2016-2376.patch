# HG changeset patch
# User Andrew Victor <andrew.victor@mxit.com>
# Date 1464900062 18000
# Branch release-2.x.y
# Node ID 19f89eda85875507ee37c9430bb8798f0afa5c0b
# Parent  5e5e84e8a79890e580158ac2eae073d7394e93b7
Fix TALOS-CAN-0118

Index: pidgin-2.10.12/libpurple/protocols/mxit/protocol.c
===================================================================
--- pidgin-2.10.12.orig/libpurple/protocols/mxit/protocol.c	2016-07-12 08:15:11.739324694 -0400
+++ pidgin-2.10.12/libpurple/protocols/mxit/protocol.c	2016-07-12 08:15:11.735324648 -0400
@@ -2841,8 +2841,9 @@
 				/* the end of the length record found */
 				session->rx_lbuf[session->rx_i] = '\0';
 				session->rx_res = atoi( &session->rx_lbuf[3] );
-				if ( session->rx_res > CP_MAX_PACKET ) {
+				if ( ( session->rx_res <= 0 ) || ( session->rx_res > CP_MAX_PACKET ) ) {
 					purple_connection_error( session->con, _( "A connection error occurred to MXit. (read stage 0x03)" ) );
+					return;
 				}
 				session->rx_state = RX_STATE_DATA;
 				session->rx_i = 0;
